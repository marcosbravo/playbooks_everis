  # UBUNTU BLOCK

  # Remove apt
  - name: NewRelic | Uninstall
    apt:
      name: newrelic-infra
      state: absent

 # Pending files
  - name: NewRelic | Find pending files associated with NewRelic on /etc
    find:
      path: '/etc'
      pattern: "*newrelic*"
      recurse: yes
      file_type: file
    register: files_etc

  - name: NewRelic | Find pending files associated with NewRelic on /var
    find:
      path: '/var'
      pattern: "*newrelic*"
      recurse: yes
      file_type: file
    register: files_var

  # - name: print
  #   debug:
  #     msg: '{{ item.path }}'
  #   with_items:
  #     - '{{ files_etc.files }}'

  - name: NewRelic | Remove pending files
    file:
      path: '{{ item.path }}'
      state: absent
    with_items:
      - '{{ files_etc.files }}'
      - '{{ files_var.files }}'

  - name: NewRelic | Get uid gpg newrelic
    shell: apt-key list | grep -B1 newrelic | head -n1
    register: gpguid

  - debug: msg='{{ gpguid.stdout }}'

    # Pending Directories

  - name: NewRelic | Find pending directories associated with NewRelic on /etc
    find:
      path: '/etc'
      pattern: "newrelic*"
      recurse: yes
      file_type: directory
    register: directories_etc

  - name: NewRelic | Find pending directories associated with NewRelic on /var
    find:
      path: '/var'
      pattern: "newrelic*"
      recurse: yes
      file_type: directory
    register: directories_var

  - name: NewRelic | Print Directories will be removed
    debug:
      msg: '{{ item.path }}'
    with_items:
      - '{{ directories_etc.files }}'
      - '{{ directories_var.files }}'

  - name: NewRelic | Remove pending directories
    file:
      path: '{{ item.path }}'
      state: absent
    with_items:
      - '{{ directories_etc.files }}'
      - '{{ directories_var.files }}'
